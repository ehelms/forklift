---
- hosts: localhost
  gather_facts: no
  vars:
    registry: 172.30.1.1:5000
    project: foreman
  tasks:
    - name: 'Docker login to openshift registry'
      shell: docker login -u developer -p $(oc whoami -t) $(minishift openshift registry)

    - set_fact:
        images: ["{{ image }}"]
      when: image is string

    - include_tasks: tasks/build-image.yml
      with_items: "{{ images }}"
      loop_control:
        loop_var: image

    - include_tasks: tasks/tag.yml
      with_items: "{{ images }}"
      loop_control:
        loop_var: image

    - include_tasks: tasks/push.yml
      with_items: "{{ images }}"
      loop_control:
        loop_var: image
